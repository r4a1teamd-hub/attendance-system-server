# プロジェクト作業報告書

## 1. プロジェクト概要

本プロジェクトは、Raspberry Piを用いた出席管理システムのリニューアルを行うものです。
従来のシステム刷新に加え、管理者向けWebアプリと学生向けモバイルアプリの開発を行いました。

### システム構成

- **バックエンド**: Python (Flask) + SQLAlchemy (SQLite)
- **管理者用Webアプリ**: React (Vite)
- **学生用モバイルアプリ**: React Native (Expo)
- **出席登録デバイス**: Raspberry Pi (PythonスクリプトによるAPI送信)

---

## 2. 実装完了機能

### バックエンド (Flask Server)

- **認証機能**: JWTを用いたセキュアな認証（ログイン、トークン検証）
- **出席管理API**:
  - `POST /api/attendance`: 出席データの受信（RasPi連携）
  - `POST /api/record_attendance`: 出席記録の手動登録
  - `GET /api/attendance/me`: 学生自身の出席履歴取得
  - `GET /api/admin/attendance`: 管理者用・全出席データ取得
  - `GET /api/admin/daily_stats`: 当日の出席統計取得
  - `GET /api/admin/monthly_attendance`: 月次出席簿データの取得
- **ユーザー管理API**:
  - `POST /api/register`: ユーザー登録
  - `POST /api/login`: ログイン
  - `GET /api/me`: 自身のユーザー情報取得
  - `GET /api/admin/users`: 管理者用・学生一覧取得
- **メール通知機能**:
  - `POST /api/admin/send_warning`: 欠席超過学生への警告メール送信（SMTP連携）

### 管理者用Webアプリ (Admin Client)

- **ダッシュボード**:
  - 当日の「出席」「遅刻」「欠席」人数をリアルタイム表示
  - 当日の出席詳細リスト表示
- **出席簿ページ**:
  - カレンダー形式（横軸に日付、縦軸に学生）での月次出席状況表示
  - 出席（緑）、遅刻（黄）、欠席（赤）の視覚的な色分け表示
  - 月選択機能
- **学生一覧ページ**:
  - 登録学生のリスト表示（教員を除外して表示）
- **レポートページ**:
  - 学生ごとの出席率・欠席数の集計表示
  - 欠席過多（20回以上）学生のハイライト表示と警告メール一括送信ボタン
  - 学生のメールアドレス表示
- **共通UI**:
  - レスポンシブなサイドバーナビゲーション
  - ログアウト機能

### 学生用モバイルアプリ (Mobile Client)

- **ログイン画面**: 学籍番号とパスワードによる認証
- **ダッシュボード**:
  - 最新の出席状況（出席回数、遅刻回数、欠席回数）のサマリー表示
  - 最新の出席記録の表示
- **出席履歴画面**:
  - 過去の全出席記録のリスト表示

---

## 3. 環境構築・検証履歴

- **データベース**:
  - SQLiteを使用し、`flask db upgrade` によるマイグレーション管理を導入
  - テストデータの生成スクリプト (`setup_test_user.py`, `create_monthly_attendance.py` 等) を作成し、開発効率を向上
- **メール設定**:
  - `.env` ファイルによる環境変数管理（セキュリティ対策）
  - Gmail SMTPサーバーとの接続確認済み
- **APIテスト**:
  - `process_attendance.py` (RasPiシミュレーション) や `verify_email_config.py` などの検証用スクリプトを作成

---

## 4. 今後の展望・課題

1. **本番環境へのデプロイ**:
    - 現在はローカル環境での動作確認のみ。クラウドサーバー（AWS, Heroku, Vercel等）へのデプロイが必要。
2. **Raspberry Pi実機連携**:
    - エミュレータでの動作は確認済みだが、実際のカードリーダー等を用いた実機テストが必要。
3. **セキュリティ強化**:
    - パスワードリセット機能の実装
    - HTTPS化（本番運用時）
    - 管理者権限の厳密な管理
4. **UI/UXの改善**:
    - 学生向けアプリへのプッシュ通知導入（「出席が記録されました」など）
    - 出席簿データのCSV/Excelエクスポート機能

---

**最終更新日**: 2025年12月9日
**作成者**: Antigravity (AI Assistant)
